# DO NOT EDIT: http://go/vendor-skycfg
load("config/kubernetes/core/container.sky", "sidecar_container")
load("config/kubernetes/plugins/compose.sky", "compose_plugins")
load("config/kubernetes/sidecars/variables.sky", "CRED_PROXY_SHIM_CONTAINER_FALLBACK_DIGEST", "CRED_PROXY_SHIM_CONTAINER_FALLBACK_ENV")

sidecar_name = "credentials-proxy-shim-sidecar"

def credentials_proxy_shim_sidecar():
    """
    Sets up a Credential Proxy Shim sidecar.
    """
    cmd = ["/pay/deploy/gocode/current/credentials-proxy-shim/shim"]

    return compose_plugins(
        sidecar_container(
            sidecar_name,
            command = cmd,
            container_image = "stripe/compute/credentials-proxy-shim",
            fallback_label = CRED_PROXY_SHIM_CONTAINER_FALLBACK_DIGEST,
            fallback_env = CRED_PROXY_SHIM_CONTAINER_FALLBACK_ENV,
            plugins = [],
        ),
    )